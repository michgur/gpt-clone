(function(){var c;htmx.defineExtension("sse",{init:function(e){c=e;if(htmx.createEventSource==undefined){htmx.createEventSource=createEventSource}},onEvent:function(e,t){switch(e){case"htmx:beforeCleanupElement":var r=c.getInternalData(t.target);if(r.sseEventSource){r.sseEventSource.close()}return;case"htmx:afterProcessNode":ensureEventSourceOnElement(t.target);registerSSE(t.target)}}});function createEventSource(e){return new EventSource(e,{withCredentials:true})}function splitOnWhitespace(e){return e.trim().split(/\s+/)}function getLegacySSEURL(e){var t=c.getAttributeValue(e,"hx-sse");if(t){var r=splitOnWhitespace(t);for(var n=0;n<r.length;n++){var s=r[n].split(/:(.+)/);if(s[0]==="connect"){return s[1]}}}}function getLegacySSESwaps(e){var t=c.getAttributeValue(e,"hx-sse");var r=[];if(t!=null){var n=splitOnWhitespace(t);for(var s=0;s<n.length;s++){var a=n[s].split(/:(.+)/);if(a[0]==="swap"){r.push(a[1])}}}return r}function registerSSE(i){var u=c.getClosestMatch(i,hasEventSource);if(u==null){return null}var e=c.getInternalData(u);var o=e.sseEventSource;queryAttributeOnThisOrChildren(i,"sse-swap").forEach(function(t){var e=c.getAttributeValue(t,"sse-swap");if(e){var r=e.split(",")}else{var r=getLegacySSESwaps(t)}for(var n=0;n<r.length;n++){var s=r[n].trim();var a=function(e){if(maybeCloseSSESource(u)){return}if(!c.bodyContains(t)){o.removeEventListener(s,a)}swap(t,e.data);c.triggerEvent(i,"htmx:sseMessage",e)};c.getInternalData(t).sseEventListener=a;o.addEventListener(s,a)}});queryAttributeOnThisOrChildren(i,"hx-trigger").forEach(function(e){var t=c.getAttributeValue(e,"hx-trigger");if(t==null){return}if(t.slice(0,4)!="sse:"){return}t=t.substr(4);var r=function(){if(maybeCloseSSESource(u)){return}if(!c.bodyContains(e)){o.removeEventListener(t,r)}}})}function ensureEventSourceOnElement(e,r){if(e==null){return null}queryAttributeOnThisOrChildren(e,"sse-connect").forEach(function(e){var t=c.getAttributeValue(e,"sse-connect");if(t==null){return}ensureEventSource(e,t,r)});queryAttributeOnThisOrChildren(e,"hx-sse").forEach(function(e){var t=getLegacySSEURL(e);if(t==null){return}ensureEventSource(e,t,r)})}function ensureEventSource(r,e,n){var s=htmx.createEventSource(e);s.onerror=function(e){c.triggerErrorEvent(r,"htmx:sseError",{error:e,source:s});if(maybeCloseSSESource(r)){return}if(s.readyState===EventSource.CLOSED){n=n||0;var t=Math.random()*(2^n)*500;window.setTimeout(function(){ensureEventSourceOnElement(r,Math.min(7,n+1))},t)}};s.onopen=function(e){c.triggerEvent(r,"htmx:sseOpen",{source:s})};c.getInternalData(r).sseEventSource=s}function maybeCloseSSESource(e){if(!c.bodyContains(e)){var t=c.getInternalData(e).sseEventSource;if(t!=undefined){t.close();return true}}return false}function queryAttributeOnThisOrChildren(e,t){var r=[];if(c.hasAttribute(e,t)){r.push(e)}e.querySelectorAll("["+t+"], [data-"+t+"]").forEach(function(e){r.push(e)});return r}function swap(t,r){c.withExtensions(t,function(e){r=e.transformResponse(r,null,t)});var e=c.getSwapSpecification(t);var n=c.getTarget(t);var s=c.makeSettleInfo(t);c.selectAndSwap(e.swapStyle,n,t,r,s);s.elts.forEach(function(e){if(e.classList){e.classList.add(htmx.config.settlingClass)}c.triggerEvent(e,"htmx:beforeSettle")});if(e.settleDelay>0){setTimeout(doSettle(s),e.settleDelay)}else{doSettle(s)()}}function doSettle(e){return function(){e.tasks.forEach(function(e){e.call()});e.elts.forEach(function(e){if(e.classList){e.classList.remove(htmx.config.settlingClass)}c.triggerEvent(e,"htmx:afterSettle")})}}function hasEventSource(e){return c.getInternalData(e).sseEventSource!=null}})();